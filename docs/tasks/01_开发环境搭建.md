# 任务01: 开发环境搭建

## 任务概述

搭建IOPaint微信小程序项目的完整开发环境，包括前端小程序开发环境和后端扩展开发环境。

## 技术要求

### 前端开发环境
- **微信开发者工具**: 最新稳定版
- **Node.js**: v16.x 或更高版本
- **npm/yarn**: 包管理工具
- **uni-app**: 推荐使用HBuilderX IDE
- **Vue.js**: 3.x 版本
- **TypeScript**: 支持类型检查

### 后端开发环境
- **Python**: 3.8+ 版本
- **FastAPI**: 现有项目已包含
- **数据库**: PostgreSQL 12+ (生产) / SQLite (开发)
- **Redis**: 缓存和会话管理
- **Docker**: 容器化部署

### 开发工具
- **版本控制**: Git
- **API测试**: Postman 或 Insomnia
- **数据库管理**: pgAdmin 或 DBeaver
- **代码编辑器**: VSCode (推荐插件清单)

## 实现步骤

### 步骤1: 前端环境搭建

#### 1.1 安装基础工具
```bash
# 安装Node.js (使用nvm管理版本)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 18
nvm use 18

# 验证安装
node --version
npm --version
```

#### 1.2 安装uni-app开发环境
```bash
# 安装HBuilderX (可选，也可使用VSCode)
# 下载地址: https://www.dcloud.io/hbuilderx.html

# 或者使用Vue CLI创建uni-app项目
npm install -g @vue/cli
npm install -g @dcloudio/uni-template-cli
```

#### 1.3 创建小程序项目
```bash
# 使用uni-app模板创建项目
vue create -p dcloudio/uni-preset-vue iopaint-miniprogram
cd iopaint-miniprogram

# 安装依赖
npm install

# 安装推荐的UI框架
npm install uview-ui
# 或
npm install @dcloudio/uni-ui
```

#### 1.4 配置微信开发者工具
1. 下载安装微信开发者工具
2. 创建小程序项目
3. 配置AppID (测试阶段可使用测试号)
4. 导入uni-app构建的项目

### 步骤2: 后端环境扩展

#### 2.1 扩展现有FastAPI项目
```bash
# 进入现有IOPaint项目目录
cd /path/to/iopaint

# 安装新的依赖
pip install python-jose[cryptography]
pip install passlib[bcrypt]
pip install python-multipart
pip install sqlalchemy
pip install alembic
pip install psycopg2-binary
pip install redis
```

#### 2.2 创建新的目录结构
```bash
mkdir -p iopaint/auth
mkdir -p iopaint/database
mkdir -p iopaint/models
mkdir -p iopaint/schemas
mkdir -p iopaint/crud
mkdir -p iopaint/utils
```

#### 2.3 配置数据库
```bash
# 安装PostgreSQL (Ubuntu)
sudo apt update
sudo apt install postgresql postgresql-contrib

# 创建数据库
sudo -u postgres createdb iopaint_miniprogram

# 配置Redis
sudo apt install redis-server
sudo systemctl start redis-server
```

### 步骤3: 开发工具配置

#### 3.1 VSCode插件安装
```json
{
  "recommendations": [
    "ms-python.python",
    "ms-python.black-formatter",
    "ms-python.isort",
    "bradlc.vscode-tailwindcss",
    "Vue.volar",
    "uni-helper.uni-app-snippets",
    "uni-helper.uni-helper-vscode",
    "GitLens.gitlens",
    "esbenp.prettier-vscode"
  ]
}
```

#### 3.2 Git仓库初始化
```bash
# 初始化Git仓库 (如果还没有)
git init
git remote add origin <repository-url>

# 创建开发分支
git checkout -b feature/miniprogram-base
```

#### 3.3 环境变量配置
```bash
# 后端环境变量 (.env)
DATABASE_URL=postgresql://user:password@localhost/iopaint_miniprogram
REDIS_URL=redis://localhost:6379/0
SECRET_KEY=your-secret-key-here
WECHAT_APP_ID=your-wechat-app-id
WECHAT_APP_SECRET=your-wechat-app-secret
JWT_ALGORITHM=HS256
JWT_EXPIRATION_TIME=30

# 小程序环境变量 (manifest.json)
```

### 步骤4: 项目结构创建

#### 4.1 小程序项目结构
```
iopaint-miniprogram/
├── src/
│   ├── pages/                 # 页面目录
│   │   ├── index/            # 首页
│   │   ├── login/            # 登录页
│   │   ├── editor/           # 图片编辑页
│   │   ├── result/           # 结果页
│   │   └── profile/          # 个人中心
│   ├── components/           # 组件目录
│   │   ├── common/           # 通用组件
│   │   └── business/         # 业务组件
│   ├── utils/                # 工具函数
│   ├── api/                  # API接口
│   ├── store/                # 状态管理
│   ├── static/               # 静态资源
│   └── styles/               # 样式文件
├── manifest.json             # 应用配置
├── pages.json               # 页面配置
└── uni.scss                 # 全局样式
```

#### 4.2 后端扩展结构
```
iopaint/
├── auth/                     # 认证模块
│   ├── __init__.py
│   ├── jwt_handler.py        # JWT处理
│   ├── wechat_auth.py        # 微信认证
│   └── middleware.py         # 认证中间件
├── database/                 # 数据库模块
│   ├── __init__.py
│   ├── connection.py         # 数据库连接
│   └── models.py             # 数据模型
├── schemas/                  # Pydantic模型
│   ├── __init__.py
│   ├── user.py
│   └── process_record.py
└── miniprogram_api/          # 小程序专用API
    ├── __init__.py
    ├── auth_router.py
    ├── user_router.py
    └── process_router.py
```

## 验收标准

### 前端环境验收
- [ ] 微信开发者工具正常运行
- [ ] uni-app项目创建成功
- [ ] 小程序基础页面可以预览
- [ ] UI框架正常引入
- [ ] 开发热重载功能正常

### 后端环境验收
- [ ] FastAPI服务正常启动
- [ ] 数据库连接成功
- [ ] Redis连接正常
- [ ] 新增的API模块可以正常导入
- [ ] 环境变量配置正确

### 开发工具验收
- [ ] Git仓库初始化完成
- [ ] VSCode插件安装完整
- [ ] 代码格式化工具配置正确
- [ ] API测试工具配置完成

## 时间估算

- **总预估时间**: 3-4天
- **前端环境搭建**: 1天
- **后端环境扩展**: 1-2天
- **工具配置和测试**: 1天

## 依赖任务

- 无 (此为第一个任务)

## 风险点

1. **兼容性问题**: uni-app版本与微信小程序基础库兼容性
2. **环境配置**: 开发团队成员环境差异导致的配置问题
3. **权限问题**: 微信小程序AppID和权限配置
4. **依赖冲突**: 新增Python包与现有项目的依赖冲突

## 解决方案

1. **版本锁定**: 明确指定所有依赖的版本号
2. **Docker化**: 考虑使用Docker统一开发环境
3. **文档详细**: 提供详细的环境搭建文档
4. **分支管理**: 使用独立分支进行开发

## 参考资料

- [uni-app官方文档](https://uniapp.dcloud.io/)
- [微信小程序开发文档](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [FastAPI官方文档](https://fastapi.tiangolo.com/)
- [HBuilderX使用指南](https://hx.dcloud.io/)

## 完成标志

环境搭建完成后，应该能够：
1. 在微信开发者工具中正常预览小程序页面
2. FastAPI服务启动并响应基础健康检查接口
3. 数据库连接测试通过
4. 团队成员能够在统一环境下开始开发工作 